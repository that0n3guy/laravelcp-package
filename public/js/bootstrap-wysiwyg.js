function initToolbarBootstrapBindings(){var e=["Serif","Sans","Arial","Arial Black","Courier","Courier New","Comic Sans MS","Helvetica","Impact","Lucida Grande","Lucida Sans","Tahoma","Times","Times New Roman","Verdana"],t=$("[title=Font]").siblings(".dropdown-menu");$.each(e,function(e,n){t.append($('<li><a data-edit="fontName '+n+'" style="font-family:\''+n+"'\">"+n+"</a></li>"))});$("a[title]").tooltip({placement:"bottom",container:"body"});$(".dropdown-menu input").click(function(){return false}).change(function(){$(this).parent(".dropdown-menu").siblings(".dropdown-toggle").dropdown("toggle")}).keydown("esc",function(){this.value="";$(this).change()});$("[data-role=magic-overlay]").each(function(){var e=$(this),t=$(e.data("target"));e.css("opacity",0).css("position","absolute").offset(t.offset()).width(t.outerWidth()).height(t.outerHeight())})}function showErrorAlert(e,t){var n="";if(e==="unsupported-file-type"){n="Unsupported format "+t}else{console.log("error uploading file",e,t)}$('<div class="alert"> <button type="button" class="close" data-dismiss="alert">&times;</button>'+"<strong>File upload error</strong> "+n+" </div>").prependTo("#alerts")}(function(e){"use strict";var t=function(e,t){var n,r,i,s;var o=0;var u=function(){o=new Date;i=null;s=e.apply(n,r)};return function(){var a=new Date;var f=t-(a-o);n=this;r=arguments;if(f<=0){clearTimeout(i);i=null;o=a;s=e.apply(n,r)}else if(!i){i=setTimeout(u,f)}return s}};var n=function(t){var n=e.Deferred(),r=new FileReader;r.onload=function(e){n.resolve(e.target.result)};r.onerror=n.reject;r.onprogress=n.notify;r.readAsDataURL(t);return n.promise()};e.fn.cleanHtml=function(t){if(e(this).data("wysiwyg-html-mode")===true){e(this).html(e(this).text());e(this).attr("contenteditable",true);e(this).data("wysiwyg-html-mode",false)}if(t===true&&e(this).parent().is("form")){var n=e(this).html;if(e(n).has("img").length){var r=e("img",e(n));var i=[];var s=e(this).parent();e.each(r,function(t,n){if(e(n).attr("src").match(/^data:image\/.*$/)){i.push(r[t]);e(s).prepend("<input value='"+e(n).attr("src")+"' type='hidden' name='postedimage/"+t+"' />");e(n).attr("src","postedimage/"+t)}})}}var o=e(this).html();return o&&o.replace(/(<br>|\s|<div><br><\/div>|&nbsp;)*$/,"")};e.fn.wysiwyg=function(r){var i=this,s=e(i).parent(),o,u,a,f=function(){if(u.activeToolbarClass){e(u.toolbarSelector,s).find(a).each(t(function(){var t=e(this).data(u.commandRole).split(" "),n=t[0];if(t.length>1&&document.queryCommandEnabled(n)&&document.queryCommandValue(n)==t[1]){e(this).addClass(u.activeToolbarClass)}else if(t.length===1&&document.queryCommandEnabled(n)&&document.queryCommandState(n)){e(this).addClass(u.activeToolbarClass)}else{e(this).removeClass(u.activeToolbarClass)}},u.keypressTimeout))}},l=function(e,t){var n=e.split(" "),r=n.shift(),i=n.join(" ")+(t||"");var s=e.split("-");if(s.length==1){document.execCommand(r,0,i)}else if(s[0]=="format"&&s.length==2){document.execCommand("formatBlock",false,s[1])}f()},c=function(){var e,t;if(window.getSelection){e=window.getSelection();if(e.getRangeAt&&e.rangeCount){t=e.getRangeAt(0)}}else if(document.selection){t=document.selection.createRange()}return t},h=function(){o=c()},p=function(){var e;if(window.getSelection||document.createRange){e=window.getSelection();if(o){try{e.removeAllRanges()}catch(t){document.body.createTextRange().select();document.selection.empty()}e.addRange(o)}}else if(document.selection&&o){o.select()}},d=function(t){if(e(i).data("wysiwyg-html-mode")!==true){var n=e(i).html();var r=e("<pre />");e(r).append(document.createTextNode(n));e(r).attr("contenteditable",true);e(i).html(" ");e(i).append(e(r));e(i).attr("contenteditable",false);e(i).data("wysiwyg-html-mode",true);e(r).focus()}else{e(i).html(e(i).text());e(i).attr("contenteditable",true);e(i).data("wysiwyg-html-mode",false);e(i).focus()}},v=function(t){i.focus();e.each(t,function(t,r){if(/^image\//.test(r.type)){e.when(n(r)).done(function(e){l("insertimage",e);i.trigger("image-inserted")}).fail(function(e){u.fileUploadError("file-reader",e)})}else{u.fileUploadError("unsupported-file-type",r.type)}})},m=function(e,t){p();if(document.queryCommandSupported("hiliteColor")){document.execCommand("hiliteColor",0,t||"transparent")}h();e.data(u.selectionMarker,t)},g=function(t,n){t.find(a,s).click(function(){p();i.focus();if(e(this).data(n.commandRole)==="html"){d()}else{l(e(this).data(n.commandRole))}h()});t.find("[data-toggle=dropdown]").click(p);t.find("input[type=text][data-"+n.commandRole+"]").on("webkitspeechchange change",function(){var t=this.value;this.value="";p();if(t){i.focus();l(e(this).data(n.commandRole),t)}h()}).on("focus",function(){var t=e(this);if(!t.data(n.selectionMarker)){m(t,n.selectionColor);t.focus()}}).on("blur",function(){var t=e(this);if(t.data(n.selectionMarker)){m(t,false)}});t.find("input[type=file][data-"+n.commandRole+"]").change(function(){p();if(this.type==="file"&&this.files&&this.files.length>0){v(this.files)}h();this.value=""})},y=function(){i.on("dragenter dragover",false).on("drop",function(e){var t=e.originalEvent.dataTransfer;e.stopPropagation();e.preventDefault();if(t&&t.files&&t.files.length>0){v(t.files)}})};u=e.extend(true,{},e.fn.wysiwyg.defaults,r);a="a[data-"+u.commandRole+"],button[data-"+u.commandRole+"],input[type=button][data-"+u.commandRole+"]";if(e(this).attr("placeholder")!=""){e(this).addClass("placeholderText");e(this).html(e(this).attr("placeholder"));e(this).bind("focus",function(t){if(e(this).attr("placeholder")!=""&&e(this).text()==e(this).attr("placeholder")){e(this).removeClass("placeholderText");e(this).html("")}});e(this).bind("blur",function(t){if(e(this).attr("placeholder")!=""&&e(this).text()==""){e(this).addClass("placeholderText");e(this).html(e(this).attr("placeholder"))}})}if(u.dragAndDropImages){y()}g(e(u.toolbarSelector),u);i.attr("contenteditable",true).on("mouseup keyup mouseout",function(){h();f()});e(window).bind("touchend",function(e){var t=i.is(e.target)||i.has(e.target).length>0,n=c(),r=n&&n.startContainer===n.endContainer&&n.startOffset===n.endOffset;if(!r||t){h();f()}});return this};e.fn.wysiwyg.defaults={toolbarSelector:"[data-role=editor-toolbar]",commandRole:"edit",activeToolbarClass:"btn-info",selectionMarker:"edit-focus-marker",selectionColor:"darkgrey",dragAndDropImages:true,keypressTimeout:200,fileUploadError:function(e,t){console.log("File upload error",e,t)}}})(window.jQuery);